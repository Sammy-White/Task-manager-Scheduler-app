$(document).ready(function(){$('#sign_up').on('submit',function(e){e.preventDefault();let formData={name:$('#name').val(),email:$('#email').val(),password:$('#password').val()}
$.ajax({type:'POST',url:'http://localhost:3000/users',headers:{'Content-Type':'application/json',},crossDomain:!0,cache:!1,data:JSON.stringify(formData),success:function(data){console.log('Sign Up Successful!')
console.log(data)
localStorage.setItem('token',data.token)
if(formData){return $(location).attr('href','/profile')}},error:function(error){console.log(error)
if(error.responseJSON.errmsg){let error='invalid email address.';$('#email').next('span').text(error)}},beforeSend:function(){console.log('Loading....')},complete:function(){console.log('Data Received Successfully!')}})})
$('#sign_in').on('submit',function(e){e.preventDefault()
let sign_in_data={email:$('#sign_in_email').val(),password:$('#sign_in_pass').val()}
$.ajax({type:'POST',url:'http://localhost:3000/users/login',headers:{'Content-Type':'application/json'},crossDomain:!0,cache:!1,data:JSON.stringify(sign_in_data),success:function(data){console.log('Login Successful')
console.log(data)
localStorage.setItem('token',data.token)
if(sign_in_data){return $(location).attr('href','/profile')}},error:function(error){console.log(error)
if(error){let error='Invalid credentails.';$('.login_page').prev('span').text(error);return $(location).attr('href','/login')}},beforeSend:function(){console.log('Loading....')},complete:function(){console.log('Data Received Successfully!')}})});getProfile();function getProfile(){$.ajax({type:'GET',url:'http://localhost:3000/users/me',headers:{'Content-Type':'application/json','Authorization':localStorage.getItem('token')},crossDomain:!0,cache:!1,success:function(data){let id=data._id;let url='http://localhost:3000/users/avatar/'+id;let image='';let profile_name='';let view='';view+="<form class='needs-validation' id='forms' novalidate>";view+="<div class='form-row'>";view+="<div class='col-md-12 mb-3'>";view+="<label for='validationCustom01'>Full Name</label>";view+="<input id='name' type='text' class='form-control' id='validationCustom01' placeholder='Full Name'  value='"+data.name+"'>";view+="<span class='errorMessage'></span>";view+="</div>";view+="<div class='col-md-12 mb-3'>";view+="<label for='validationCustom02'>Email Address</label>";view+="<input id='email' type='email' class='form-control' id='validationCustom02'  value="+data.email+"  disabled>";view+="</div>";view+="<div class='col-md-12 mb-3'>";view+="<label for='validationCustom03'>Age</label>";view+="<input id='age' type='number' class='form-control' id='validationCustomUsername' placeholder='Age' value="+data.age+">";view+="<span class='errorMessage'></span>";view+="</div>";view+="<div class='col-md-12 mb-3'>";view+="<label for='validationCustom03'>New Password</label>";view+="<input id='pass1' type='password' class='form-control' id='validationCustom04' placeholder='Password'>";view+="<span class='errorMessage'></span>";view+="</div>";view+="<div class='col-md-12 mb-3'>";view+="<label for='validationCustom03'>Repeat-Password</label>";view+="<input id='pass2' type='password' class='form-control' id='validationCustom05' placeholder='Repeat-Password'>";view+="<span class='errorMessage'></span>";view+="</div>";view+="<button id='profile_save' class='btn btn-primary'>Save</button>";view+="</form>";profile_name+=" <p class='name'>"+data.name+"</p>";profile_name+="<p class='role'>Manager</p>";image+="<img class='img-src' src="+url+" alt=''>";$('.users-form').html(view);$('.profile_data').html(profile_name);$('.profile_img').html(image)},error:function(error){console.log(error)}})};$('body').on('click','#profile_save',function(e){e.preventDefault();let pass1=$('#pass1').val();let pass2=$('#pass2').val();if(pass1!=pass2){let error='password confirmation doesn\'t  match.';$('#pass1').next('span').text(error);$('#pass2').next('span').text(error);$('#pass1').css("borderColor","red");$('#pass2').css("borderColor","red");return}else{$('#pass1').css("borderColor","green");$('#pass2').css("borderColor","green");let error='password confirmation doesn\'t  match.';$('#pass1').next('span').text(error).hide();$('#pass2').next('span').text(error).hide()}
let age=$('#age').val();if(age<=11){let error='user age must be greater than 11';$('#age').next('span').text(error);$('#age').css("borderColor","red");return}else{$('#age').css("borderColor","green");let error='user age must be greater than 11';$('#age').next('span').text(error).hide()}
let name=$('#name').val();if(name===""||name===null){let error='user name cannot be empty!';$('#name').next('span').text(error);$('#name').css("borderColor","red");return}else{$('#name').css("borderColor","green");let error='user name cannot be empty!';$('#name').next('span').text(error).hide()}
let users={name:$('#name').val(),age:$('#age').val(),password:$('#pass2').val()}
$.ajax({type:'PATCH',url:'http://localhost:3000/users/me',headers:{'Content-Type':'application/json','Authorization':localStorage.getItem('token')},crossDomain:!0,cache:!1,data:JSON.stringify(users),success:function(data){console.log('Profile Edited Successfully!')
console.log(data)
window.location.href="/profile"},error:function(error){console.log(error)}})});$('#submit-upload').click(function(e){e.preventDefault();let upload=new FormData();upload.append("avatar",$('#myFile')[0].files[0]);$.ajax({type:'POST',url:'http://localhost:3000/users/me/avatar',headers:{'Authorization':localStorage.getItem('token')},crossDomain:!0,cache:!1,data:upload,processData:!1,contentType:!1,success:function(data){console.log(data)
console.log('Image uploaded successfully!')
window.location.href="/profile"},error:function(error){console.log(error)},beforeSend:function(){console.log('Loading....')},complete:function(){console.log('Data Received Successfully!')}})});$('#delete-upload').click(function(e){e.preventDefault();$.ajax({type:'DELETE',url:'http://localhost:3000/users/me/avatar',headers:{'Authorization':localStorage.getItem('token')},crossDomain:!0,cache:!1,success:function(data){console.log(data)
console.log('Image Deleted successfully!')
window.location.href="/profile"},error:function(error){console.log(error)},beforeSend:function(){console.log('Loading....')},complete:function(){console.log('Data Received Successfully!')}})});$('#delete-profile').click(function(e){e.preventDefault();let message=confirm('Are you sure you want to delete your account?\nIf you click yes you will loose all saved data and your account will be permanently deleted!.\n');if(message==!0){$.ajax({type:'DELETE',url:'http://localhost:3000/users/me',headers:{'Authorization':localStorage.getItem('token')},crossDomain:!0,cache:!1,success:function(data){console.log(data)
console.log('User Deleted successfully!')
window.location.href="/"},error:function(error){console.log(error)},beforeSend:function(){console.log('Loading....')},complete:function(){console.log('Data Received Successfully!')}})}});$('#logout').click(function(e){e.preventDefault()
let sign_out_data={sign_out:$('#logout')}
$.ajax({type:'POST',url:'http://localhost:3000/users/logout',headers:{'Content-Type':'application/json','Authorization':localStorage.getItem('token')},crossDomain:!0,cache:!1,data:JSON.stringify(sign_out_data),success:function(data){console.log('Logout Successful')
console.log(data)
if(sign_out_data){return $(location).attr('href','/login')}},error:function(error){console.log(error)}})})})